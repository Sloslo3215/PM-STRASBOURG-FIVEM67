<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Créer un Bulletin</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
    form { background: white; padding: 20px; border-radius: 10px; max-width: 600px; margin: auto; }
    input, textarea { width: 100%; margin-bottom: 10px; padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
    button { padding: 10px 20px; background-color: #007BFF; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background-color: #0056b3; }
  </style>
</head>
<body>

<h2>Créer un Bulletin de Service</h2>

<form id="bulletinForm">
  <input type="text" id="titre" placeholder="Titre du bulletin" required>
  <input type="text" id="identifiant" placeholder="Identifiant (auteur)" required>
  <input type="date" id="debutService" required>
  <input type="date" id="finService" required>
  <textarea id="contenu" placeholder="Contenu du bulletin" rows="6" required></textarea>
  <button type="submit">Enregistrer</button>
</form>

<script>
  const username = "TON_UTILISATEUR"; // Remplace par ton nom d'utilisateur GitHub
  const repo = "TON_DEPOT"; // Nom du dépôt GitHub
  const path = "bulletins.json"; // Fichier contenant les bulletins
  const token = "TON_TOKEN"; // Jeton GitHub personnel

  document.getElementById('bulletinForm').addEventListener('submit', async function (e) {
    e.preventDefault();

    const bulletin = {
      titre: document.getElementById('titre').value,
      identifiant: document.getElementById('identifiant').value,
      debutService: document.getElementById('debutService').value,
      finService: document.getElementById('finService').value,
      contenu: document.getElementById('contenu').value,
      date: new Date().toLocaleString(),
      timestamp: Date.now()
    };

    const url = `https://api.github.com/repos/${username}/${repo}/contents/${path}`;

    try {
      // Récupérer le contenu actuel
      const res = await fetch(url, {
        headers: { Authorization: `Bearer ${token}` }
      });
      const data = await res.json();
      const existingContent = JSON.parse(atob(data.content));
      existingContent.push(bulletin);

      // Mise à jour du fichier
      const update = await fetch(url, {
        method: 'PUT',
        headers: {
          Authorization: `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          message: "Ajout d’un nouveau bulletin",
          content: btoa(unescape(encodeURIComponent(JSON.stringify(existingContent, null, 2)))),
          sha: data.sha
        })
      });

      if (update.ok) {
        alert("Bulletin enregistré avec succès !");
        location.reload();
      } else {
        throw new Error("Erreur lors de l’enregistrement");
      }
    } catch (error) {
      alert("Une erreur est survenue : " + error.message);
    }
  });
</script>

</body>
</html>
